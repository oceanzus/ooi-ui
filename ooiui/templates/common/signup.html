{% extends "common/base.html" %}

{% block title %}
    <title>Register New User</title>
{% endblock %}

{% block head %}
  <link rel="stylesheet" href="/css/compiled/signup.css" type="text/css" />
  <link rel="stylesheet" href="/css/compiled/loginDemo.css" type="text/css" />
  <!-- Partials -->
  <script src="/js/partials/compiled/signup.js" type="text/javascript"></script>
  <script src="/js/compiled/signup.js" type="text/javascript"></script>
{% endblock %}

{%block body %}
<div class="container-fluid">
  <div class="row">
    <div class="col-lg-12">
      <form class="form-horizontal" role="form">
        <h3>New User Registration</h3>
        <hr width="80%">

        <div class="form-group">
          <label for="email" class="col-sm-3 control-label">Email</label>
          <div class="col-sm-6">
            <input type="email" class="form-control" id="email" name="email" />
            <span class="help-block hidden"></span>
          </div>
        </div>
        <div class="form-group">
          <label for="password" class="col-sm-3 control-label">Password</label>
          <div class="col-sm-6">
            <input type="password" class="form-control" id="password" name="password" />
            <span class="help-block hidden"></span>
          </div>
        </div>
        <div class="form-group">
          <label for="repeatPassword" class="col-sm-3 control-label">Re-enter Password</label>
          <div class="col-sm-6">
            <input type="password" class="form-control" id="repeatPassword" name="repeatPassword" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <hr width ="80%">

        <div class="form-group">
          <label for="firstname" class="col-sm-3 control-label">First Name</label>
          <div class="col-sm-6">
            <input type="text" class="form-control" id="first_name" name="first_name" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <label for="lastname" class="col-sm-3 control-label">Last Name</label>
          <div class="col-sm-6">
            <input type="text" class="form-control" id="last_name" name="last_name" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <label for="phone_primary" class="col-sm-3 control-label">Primary Phone</label>
          <div class="col-sm-6">
            <input type="text" class="form-control" id="phone_primary"
                   name="phone_primary" placeholder="Example: (321) 456-7890 or (321) 456-7890x1234" />
            <span class="help-block hidden"></span>
          </div>

        </div>
        <div class="form-group">
          <label for="phone_alternate" class="col-sm-3 control-label">Secondary Phone</label>
          <div class="col-sm-6">
            <input type="text" class="form-control" id="phone_alternate"
                   name="phone_alternate" placeholder="Example: (321) 456-7890 or (321) 456-7890x1234" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group" style='display:none;'>
          <label for="organization" class="col-sm-3 control-label">Organization</label>
          <div class="col-sm-6">
            <select class="form-control" id="organization" name="organization">
            </select>
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div id="other_org_div" class="form-group">
          <label for="other_organization" class="col-sm-3 control-label">Organization</label>
          <div class="col-sm-6">
            <input type="text" class="form-control" id="other_organization" name="other_organization" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <label for="vocation" class="col-sm-3 control-label">Vocation/Discipline</label>
          <div class="col-sm-6 ">
            <select class="form-control" id="vocation" name="vocation">
              <option value="Researcher" >Researcher</option>
              <option value="Educator" >Educator</option>
              <option value="Student" >Student</option>
              <option value="Commercial" >Commercial</option>
              <option value="Government" >Government</option>
              <option value="Nonprofit" >Nonprofit</option>
              <option value="Cyberinfrastructure" >Cyberinfrastructure</option>
              <option value="Other" >Other</option>
            </select>
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <label for="country" class="col-sm-3 control-label">Country</label>
          <div class="col-sm-6 ">
            <select class="form-control" id="country" name="country">
            </select>
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div id='state_div' class="form-group">
          <label for="state" class="col-sm-3 control-label">State</label>
          <div class="col-sm-6 ">
            <select class="form-control" id="state" name="state">
            </select>
            <span class="help-block hidden"></span>
          </div>
        </div>

        <hr width="80%">
{#        <div class="form-group">#}
{#          <label for="role" class="col-sm-3 control-label">Role</label>#}
{#          <div class="col-sm-6 ">#}
{#            <select class="form-control" id="role_name" name="role_name">#}
{#            </select>#}
{#            <span class="help-block hidden"></span>#}
{#          </div>#}
{#        </div>#}

        <div class="form-group">
          <label for="email_opt_in" class="col-sm-3 control-label">Send me important OOI updates via email.</label>
          <div class="col-sm-6">
            <input type="checkbox" value="true" class="form-control" id="email_opt_in" name="email_opt_in" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <label for="" class="col-sm-3 control-label">I Agree To The <a class="terms-link">Terms and Conditions</a></label>
          <div class="col-sm-6">
            <input type="checkbox" value="false" class="form-control" id="terms_agree" name="terms_agree" />
            <span class="help-block hidden"></span>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-12">
            <button type="button" disabled id="submitButton" class="btn btn-primary">Submit</button>
            <button type="button" id="resetButton" class="btn btn-primary">Reset</button>

          </div>
        </div>
      </form>
    </div>
  </div> <!-- row -->
<div id="loginHolder"></div>
</div>
<script type="text/javascript">

var csrf_token = "{{ csrf_token() }}";

_.extend(OOI.prototype, Backbone.Events, {
  login: new LoginModel(),
  views: {},
  models: {
    stateModel: new StateModel()
  },
  collections: {
{#    roles: new Roles(),#}
    orgs: new Organizations(),
    countries: new CountryCollection(),
    states: new StateCollection()
  },
  csrf_token: csrf_token,
  initViews: function() {

    this.views.signupview = new SignUpForm({
        el: 'form',
        model: new SignUpModel()
    });

  },
  initEvents: function() {
    this.listenTo(this, "login:success", this.onLogin);
    this.listenTo(this, "login:logout", this.onLogout);
    this.listenTo(this, "country:onchange", this.countrySelection);
  },
  start: function() {
    var self = this;
    this.initEvents();
    this.login.fetch({async:false});
{#    this.models.stateModel.fetchCurrent('US');#}
    var complete = _.invoke([
      //this.collections.roles,
      this.collections.orgs,
      this.collections.countries,
      this.collections.states], 'fetch');
    $.when.apply($, complete).then(function() {
      self.initViews();
      self.trigger('ooi:sync');
      $('#country option[value="United States"]').attr("selected", "selected");
      $('#vocation option[value="Researcher"]').attr("selected", "selected");
    }, function() {
      self.initViews();
    });

  },
  countrySelection: function(country_code) {
    //console.log('country_code: ' + country_code);
    this.models.stateModel.fetchCurrent(country_code);
    this.collections.states.fetch({url: '/api/states/' + country_code});
  }
});

var ooi = new OOI();

$(document).ready(function () {
  ooi.start();
});
</script>
{% endblock %}
