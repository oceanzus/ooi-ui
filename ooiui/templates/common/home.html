{% extends "common/base.html" %}

{% block title %}
<title>OOI - Home</title>
{% endblock %}

{% block beforebootstrap %}

{% endblock %}

{% block head %}
<meta name='viewport' content='initial-scale=2,maximum-scale=3,user-scalable=yes' />
<link href="/css/custom/banner.css" rel="stylesheet" type="text/css" />
<link href="/css/custom/navbar.css" rel="stylesheet" type="text/css" />
<link href="/css/custom/custom.css" rel="stylesheet" type="text/css" />
<link href="/css/compiled/index.css" rel="stylesheet" type="text/css" />
<link href="/css/home/home.css" rel="stylesheet" type="text/css" />
<link href="/css/home/array_content/array_content.css" rel="stylesheet" type="text/css" />
<link href="/css/home/vector_map/vector_map.css" rel="stylesheet" type="text/css"/>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.17.0/mapbox-gl.css' rel='stylesheet' />
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<!-- page resources --<>

    <!-- Partials -->
    <script src="/js/partials/compiled/index.js" type="text/javascript"></script>
    <script src="/js/partials/compiled/landingPages.js" type="text/javascript"></script>
    <script src="/js/compiled/index.js" type="text/javascript"></script>
    <script src="/js/compiled/landingPages.js" type="text/javascript"></script>
    <script src="/js/partials/compiled/home.js" type="text/javascript"></script>
    <script src="/js/models/asset_management/PlatformModel.js" type="text/javascript"></script>

    <script src="/js/views/home/vector_map/vector_map.js" type="text/javascript"></script>
    <script src="/js/views/home/array_content/array_content.js" type="text/javascript"></script>

    <script src="/lib/d3/d3.min.js" type="text/javascript"></script>
    <script src="/js/views/home/tile_map/tile_map.js" type="text/javascript"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.17.0/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
{% endblock %}

{%block body %}
<div class="container-fluid">
    <div id="navbar" class="row"></div>
</div>

<div id="wrapper" class="home-page" style="padding-left: 0px">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4" id="left">
                <div class="array-content"></div>
            </div>
            <div class="col-md-8 visible-lg visible-md" id="right">
                <div id="map"></div>
                <pre id="info"></pre>
            </div>
        </div>
    </div>
</div><!-- wrapper -->

<!-- fade in image -->
<script>
// Instantiate the application for this page
var ooi = new OOI();

var vent = _.extend({}, Backbone.Events);

$(document).ready(function() {
    var arrayCollection = new ArrayCollection(),
        platformCollection = new PlatformCollection();

    arrayCollection.fetch().then(function() {
        platformCollection.fetch().then(function() {
            // set to 'tile' to use tile maps, set to 'vector' to use vector maps.
            // both maps require a valid geoJson as a toJSON override.
            var mapStyle = 'vector';

            if (mapStyle === 'tile') {
                var tileMap = new TileMap({id: 'map', collection: {arrayCollection, platformCollection}});
                tileMap.render();
            } else if(mapStyle === 'vector') {
                var vectorMap = new VectorMap({id: 'map', collection: {arrayCollection, platformCollection}});
                vectorMap.render();
            }

            var arrayContent = new ArrayContentSummary({el: $('.array-content'), collection: {arrayCollection, platformCollection}});
            arrayContent.render();
        });
    });


    // Takes care of the strange size of the map
    window.onresize = function(event) {
        resizeMap();
    };

    var resizeMap = (function() {
        vpw = $(window).width() - 200;
        //vph = $('#sidebar-wrapper').height() - 100;
        vph = $(window).height() - 150;
        $('#map').css({'height': vph + 'px'});
        $('.array-content').css({'height': vph + 'px'});
    });
    resizeMap();

    ooi.start();
});

var bannerTitle = "Home";

_.extend(OOI.prototype, Backbone.Events,  {
    login: new LoginModel(),
    views: {},
    collections: {
        organizations: new Organizations(),
    },
    models: {},

    start: function() {
        var self = this;
        this.login.fetch({async:false});
        //--------------------------------------------------------------------------------
        // Views
        //--------------------------------------------------------------------------------
        this.views.banner = new BannerView({bannerTitle});
        $('body').prepend(this.views.banner.el);

        this.views.navbar = new NavbarView({
            el: $('#navbar')
        });
    },
    renderVectorMap: function() {


    }
});
</script>
{% endblock %}
